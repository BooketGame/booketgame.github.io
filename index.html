<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DSD256 Music Player — Music Search</title>

<!-- reCAPTCHA v2 -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<style>
  * { box-sizing:border-box; }
  body { margin:0; font-family: "Poppins", sans-serif; background:#0f0b20; color:#fff; display:flex; flex-direction:column; align-items:center; padding-top:50px; min-height:100vh; }
  #titleWrapper { cursor:pointer; text-align:center; margin-bottom:15px; }
  #mainTitle { font-size:2rem; margin:0; }
  #titleQuote { font-size:0.85rem; color:#ccc; margin-top:6px; min-height:1em; }
  .search-box { display:flex; width:90%; max-width:560px; margin-bottom:20px; }
  .search-box input { flex:1; padding:12px; border-radius:30px; border:none; outline:none; }
  .search-box button { margin-left:8px; padding:10px 16px; border:none; border-radius:28px; cursor:pointer; background:#6c63ff; color:#fff; }
  #results { width:90%; max-width:700px; display:flex; flex-direction:column; gap:10px; margin-bottom:20px; }
  .result-item { display:flex; gap:10px; align-items:center; background:#1f1f2f; padding:8px; border-radius:10px; cursor:pointer; }
  .result-item img { width:50px; height:50px; object-fit:cover; border-radius:6px; }
  .info { display:flex; flex-direction:column; }
  #player-section { display:flex; flex-direction:column; align-items:center; gap:6px; margin-bottom:20px; }
  #playlist { width:90%; max-width:500px; background:#222; border-radius:10px; padding:10px; list-style:none; min-height:50px; }
  #playlist li { display:flex; justify-content:space-between; align-items:center; padding:6px; border-bottom:1px solid #444; }
  #adminBtn { position:fixed; top:10px; right:10px; padding:6px 10px; border-radius:8px; background:#6c63ff; color:#fff; border:none; cursor:pointer; }
  #adminPanel { position:fixed; top:50px; right:10px; width:320px; background:#111; border-radius:10px; padding:12px; opacity:0; pointer-events:none; transition:0.2s; }
  #adminPanel.open { opacity:1; pointer-events:auto; }
  .btn { background:#6c63ff; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
  .playlist-controls { display:flex; gap:8px; margin-top:6px; }
  #locked { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.8); z-index:9999; }
</style>
</head>
<body>

<div id="titleWrapper">
  <h1 id="mainTitle">DSD256 Music Player</h1>
  <div id="titleQuote"></div>
</div>

<div class="search-box">
  <input id="query" type="text" placeholder="Search for a song..." />
  <button id="search">Search</button>
</div>

<div id="results"></div>

<div id="player-section">
  <div id="nowPlaying"></div>
  <button id="pauseBtn" style="display:none;">⏸ Pause</button>
  <input type="range" id="seekBar" value="0" min="0" max="100" style="display:none;" />
  <div id="timeDisplay" style="display:none;"><span id="currentTime">0:00</span>/<span id="totalTime">0:00</span></div>
</div>

<ul id="playlist"></ul>
<div class="playlist-controls">
  <button id="exportPlaylistBtn" class="btn">Export Playlist</button>
  <button id="importPlaylistBtn" class="btn">Import Playlist</button>
  <input type="file" id="importPlaylistInput" style="display:none;" />
</div>

<!-- Admin -->
<button id="adminBtn">Admin Login</button>
<div id="adminPanel">
  <strong>Admin Panel</strong>
  <p>Password: DSD2562025</p>
</div>

<!-- reCAPTCHA lock -->
<div id="locked">
  <div class="g-recaptcha" data-sitekey="6Lfs5u4rAAAAABKDdVRJk17X2uMk7l2mzi6frduJ" data-callback="unlockSite"></div>
</div>

<div id="player"></div>

<script>
const YT_API_KEY = "AIzaSyDkXj66lPy0lC7sRrGfXzFk7dww0c_jkg0";
const ADMIN_PW = "DSD2562025";

const titleQuoteEl = document.getElementById("titleQuote");
const queryInput = document.getElementById("query");
const searchBtn = document.getElementById("search");
const resultsDiv = document.getElementById("results");
const nowPlaying = document.getElementById("nowPlaying");
const pauseBtn = document.getElementById("pauseBtn");
const seekBar = document.getElementById("seekBar");
const currentTimeEl = document.getElementById("currentTime");
const totalTimeEl = document.getElementById("totalTime");
const timeDisplay = document.getElementById("timeDisplay");

const playlistEl = document.getElementById("playlist");
let playlist = [];

const adminBtn = document.getElementById("adminBtn");
const adminPanel = document.getElementById("adminPanel");

let ytPlayer, isPaused=false, updateInterval;

const TITLE_QUOTES=["click me!","this site goes hard","hello","spotify sucks"];
function changeQuote(){ titleQuoteEl.textContent=TITLE_QUOTES[Math.floor(Math.random()*TITLE_QUOTES.length)]; }
setInterval(changeQuote,5000);

async function searchYT(query){
  resultsDiv.innerHTML="Searching...";
  const url=`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=6&q=${encodeURIComponent(query)}&key=${YT_API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  renderResults(data.items||[]);
}

function renderResults(items){
  resultsDiv.innerHTML="";
  if(!items.length){ resultsDiv.textContent="No results."; return; }
  items.forEach(item=>{
    const vid=item.id.videoId;
    const title=item.snippet.title;
    const channel=item.snippet.channelTitle;
    const thumb=item.snippet.thumbnails?.medium?.url||"";
    const div=document.createElement("div");
    div.className="result-item";
    div.innerHTML=`<img src="${thumb}"><div class="info"><strong>${title}</strong><span>${channel}</span></div><button>➕</button>`;
    div.querySelector(".info").addEventListener("click",()=>playAudio(vid,title,channel));
    div.querySelector("button").addEventListener("click",()=>addToPlaylist({videoId:vid,title,channel}));
    resultsDiv.appendChild(div);
  });
}

function playAudio(videoId,title,channel){
  nowPlaying.style.display="block";
  pauseBtn.style.display="inline-block";
  seekBar.style.display="block";
  timeDisplay.style.display="flex";
  nowPlaying.textContent=`Now Playing: ${title} — ${channel}`;
  if(ytPlayer) ytPlayer.loadVideoById(videoId);
  else ytPlayer=new YT.Player('player',{height:'0',width:'0',videoId:videoId,events:{onReady:e=>e.target.playVideo(),onStateChange:onPlayerStateChange}});
}

pauseBtn.addEventListener("click",()=>{
  if(!ytPlayer)return;
  if(isPaused){ ytPlayer.playVideo(); pauseBtn.textContent="⏸ Pause"; } 
  else { ytPlayer.pauseVideo(); pauseBtn.textContent="▶ Play"; }
  isPaused=!isPaused;
});

seekBar.addEventListener("input",()=>{ if(ytPlayer) ytPlayer.seekTo(seekBar.value/100*ytPlayer.getDuration(),true); });

function onPlayerStateChange(e){
  clearInterval(updateInterval);
  if(e.data===YT.PlayerState.PLAYING){
    updateInterval=setInterval(()=>{
      const dur=ytPlayer.getDuration(), cur=ytPlayer.getCurrentTime();
      if(dur>0){ seekBar.value=(cur/dur)*100; currentTimeEl.textContent=formatTime(cur); totalTimeEl.textContent=formatTime(dur); }
    },500);
  }
}

function formatTime(sec){ const m=Math.floor(sec/60), s=Math.floor(sec%60); return m+":"+s.toString().padStart(2,"0"); }

function addToPlaylist(song){ playlist.push(song); renderPlaylist(); }
function renderPlaylist(){
  playlistEl.innerHTML="";
  if(!playlist.length){ const li=document.createElement("li"); li.style.color="#aaa"; li.textContent="Playlist is empty."; playlistEl.appendChild(li); return; }
  playlist.forEach((song,i)=>{
    const li=document.createElement("li");
    li.innerHTML=`<div style="flex:1; cursor:pointer;">${song.title} — ${song.channel}</div><button>❌</button>`;
    li.querySelector("div").addEventListener("click",()=>playAudio(song.videoId,song.title,song.channel));
    li.querySelector("button").addEventListener("click",(e)=>{ e.stopPropagation(); playlist.splice(i,1); renderPlaylist(); });
    playlistEl.appendChild(li);
  });
}

document.getElementById("exportPlaylistBtn").addEventListener("click",()=>{
  if(!playlist.length) return alert("Playlist empty!");
  const blob=new Blob([JSON.stringify(playlist,null,2)],{type:"application/json"});
  const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="playlist.json"; a.click(); URL.revokeObjectURL(a.href);
});

document.getElementById("importPlaylistBtn").addEventListener("click",()=>document.getElementById("importPlaylistInput").click());
document.getElementById("importPlaylistInput").addEventListener("change",(e)=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{ try{ playlist=JSON.parse(reader.result); renderPlaylist(); } catch(err){ alert("Invalid JSON"); } };
  reader.readAsText(file);
});

// Admin Login
adminBtn.addEventListener("click",()=>{
  const pw = prompt("Enter admin password:");
  if(pw===ADMIN_PW) adminPanel.classList.add("open");
  else if(pw!==null) alert("Incorrect password!");
});

// reCAPTCHA unlock
function unlockSite(){ document.getElementById("locked").style.display="none"; }

searchBtn.addEventListener("click",()=>searchYT(queryInput.value));
queryInput.addEventListener("keypress",e=>{ if(e.key==="Enter") searchYT(queryInput.value); });

// Load YouTube IFrame API
let tag=document.createElement('script'); tag.src="https://www.youtube.com/iframe_api"; document.body.appendChild(tag);
</script>

</body>
</html>
