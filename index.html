<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clever | Portal</title>

  <!-- Google reCAPTCHA (real) -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <link rel="icon" type="image/png" href="logo.png">

  <style>
    /* === Core layout / theme === */
    * { box-sizing: border-box; }
    html,body { height:100%; }
    body {
      margin:0;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg,#141414,#1e1e2f);
      color: #fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding-top:60px;
      min-height:100vh;
      overflow:auto;
    }

    /* header / title */
    h1 {
      font-size:2.2rem;
      letter-spacing:1px;
      margin: 0 0 18px 0;
      text-align:center;
      max-width: 1000px;
      padding: 0 16px;
      cursor: pointer;
      user-select: none;
      transition: color .18s ease, transform .18s ease;
    }
    h1:hover { color: #bfaaff; transform: scale(1.01); }

    /* search box */
    .search-box {
      display:flex;
      align-items:center;
      background:#222;
      border-radius:50px;
      padding:6px 10px;
      width:90%;
      max-width:560px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.45);
    }
    .search-box input {
      flex:1;
      padding:14px 18px;
      border:none;
      outline:none;
      background:transparent;
      color:#fff;
      font-size:1rem;
      border-radius: 40px;
    }
    .search-box button {
      margin-left:10px;
      background:#6c63ff;
      border:none;
      color:white;
      padding:10px 18px;
      border-radius:28px;
      cursor:pointer;
      box-shadow: 0 6px 0 rgba(0,0,0,0.35);
      font-weight:600;
      transition: background .15s ease, transform .12s ease;
    }
    .search-box button:hover { background:#574ede; transform: translateY(-1px); }

    /* player card */
    #player-section {
      margin-top:18px;
      width:90%;
      max-width:560px;
      background:#1c1c2a;
      border-radius:14px;
      padding:18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
    }
    #nowPlaying { display:none; color:#ddd; text-align:center; }
    #pauseBtn { display:none; background:#6c63ff; border:none; color:white; padding:8px 14px; border-radius:20px; cursor:pointer; }
    #seekBar { display:none; width:100%; height:6px; appearance:none; background:#333; border-radius:8px; outline:none; }
    #seekBar::-webkit-slider-thumb { appearance:none; width:12px; height:12px; background:#6c63ff; border-radius:50%; }

    #timeDisplay { display:none; width:100%; font-size:.9rem; color:#bbb; justify-content:space-between; }

    /* results */
    .results {
      margin-top:28px;
      display:flex;
      flex-direction:column;
      width:90%;
      max-width:700px;
      gap:12px;
    }
    .result-item {
      background:#1f1f2f;
      border-radius:12px;
      padding:10px;
      display:flex;
      gap:12px;
      align-items:center;
      cursor:pointer;
      transition: background .14s ease, transform .12s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    }
    .result-item:hover { background:#2a2a3f; transform: translateY(-2px); }
    .result-item img { width:56px; height:56px; border-radius:10px; object-fit:cover; }
    .info { display:flex; flex-direction:column; gap:6px; }
    .info strong { font-size:1rem; color:#fff; }
    .info span { color:#aaa; font-size:.9rem; }

    /* disclaimer */
    .disclaimer { position:fixed; right:16px; bottom:8px; color:#777; font-size:.76rem; text-align:right; }

    /* lock overlay (reCAPTCHA) */
    #locked {
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg, rgba(6,6,8,0.85), rgba(6,6,8,0.9));
      z-index:9999;
      transition: opacity 800ms ease;
    }
    #locked.fade-out { opacity:0; pointer-events:none; }
    .lock-box {
      width:360px;
      background: linear-gradient(180deg,#111220,#0b0b10);
      border-radius:14px;
      padding:22px;
      text-align:center;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    }
    .lock-box h2 { margin:0 0 12px 0; color:#cfcfe6; font-size:1.1rem; }
    .grecaptcha-wrap { display:flex; justify-content:center; margin-top:6px; }

    /* responsive */
    @media (max-width:520px) {
      h1 { font-size:1.4rem; padding:0 12px; }
      .search-box input { padding:12px; }
      .lock-box { width:92%; padding:16px; }
    }
  </style>
</head>
<body>
  <!-- LOCK overlay with real reCAPTCHA -->
  <div id="locked">
    <div class="lock-box" role="dialog" aria-modal="true" aria-label="Verification required">
      <h2>Verify you're human to continue üéß</h2>
      <div class="grecaptcha-wrap">
        <!-- REAL site key you provided -->
        <div class="g-recaptcha" data-sitekey="6Lfs5u4rAAAAABKDdVRJk17X2uMk7l2mzi6frduJ" data-callback="unlockSite"></div>
      </div>
    </div>
  </div>

  <!-- MAIN UI -->
  <h1 id="mainTitle">DSD256 Music Player ‚Äî Music Search</h1>

  <div class="search-box" role="search" aria-label="Search for music">
    <input id="query" type="text" placeholder="type it in already..." aria-label="Search input" />
    <button id="search">Search</button>
  </div>

  <div id="player-section" aria-live="polite">
    <div id="nowPlaying"></div>
    <button id="pauseBtn">‚è∏ Pause</button>
    <input type="range" id="seekBar" value="0" min="0" max="100" />
    <div id="timeDisplay"><span id="currentTime">0:00</span><span id="totalTime">0:00</span></div>
  </div>

  <div id="results" class="results" aria-label="Search results"></div>

  <div id="player"></div> <!-- invisible YouTube iframe inserted by API -->

  <div class="disclaimer">¬© 2025 DSD256 ‚Äî Music Search ‚Äî audio streamed via YouTube API. We are not affiliated with Spotify or YouTube.</div>

  <script>
    /* ============== Settings ============== */
    const YT_API_KEY = "AIzaSyDkXj66lPy0lC7sRrGfXzFk7dww0c_jkg0"; // your YouTube API key (as requested)
    const SITEKEY_RECAPTCHA = "6Lfs5u4rAAAAABKDdVRJk17X2uMk7l2mzi6frduJ"; // already used in DOM

    /* ============== Title random quotes ============== */
    const TITLE_QUOTES = [
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
      "DSD256 Music Player - Music Search",
    ];
    const titleEl = document.getElementById("mainTitle");

    function pickRandom(arr, avoid) {
      if (!arr.length) return "";
      if (arr.length === 1) return arr[0];
      let idx;
      do { idx = Math.floor(Math.random() * arr.length); } while (arr[idx] === avoid);
      return arr[idx];
    }

    // set initial random title on load
    (function initTitle() {
      const first = pickRandom(TITLE_QUOTES, null);
      titleEl.textContent = first;
    })();

    // change title on click (no repeats back-to-back)
    titleEl.addEventListener("click", () => {
      const next = pickRandom(TITLE_QUOTES, titleEl.textContent);
      titleEl.textContent = next;
      // small visual feedback
      titleEl.style.transform = "scale(1.02)";
      setTimeout(() => titleEl.style.transform = "", 140);
    });

    /* ============== reCAPTCHA unlock callback ============== */
    function unlockSite() {
      const lock = document.getElementById("locked");
      lock.classList.add("fade-out");
      // keep small delay to allow fade
      setTimeout(() => {
        lock.style.display = "none";
        document.body.style.overflow = "auto";
      }, 900);
    }

    /* ============== YouTube search & player ============== */
    const searchBtn = document.getElementById("search");
    const queryInput = document.getElementById("query");
    const resultsDiv = document.getElementById("results");
    const nowPlaying = document.getElementById("nowPlaying");
    const pauseBtn = document.getElementById("pauseBtn");
    const seekBar = document.getElementById("seekBar");
    const currentTimeEl = document.getElementById("currentTime");
    const totalTimeEl = document.getElementById("totalTime");
    const timeDisplay = document.getElementById("timeDisplay");

    let ytPlayer = null;
    let isPaused = false;
    let updateInterval = null;

    async function searchYouTube(query) {
      resultsDiv.innerHTML = `<div style="color:#aaa;padding:12px">Searching for "${query}"‚Ä¶</div>`;
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=8&q=${encodeURIComponent(query)}&key=${YT_API_KEY}`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("Network response not ok");
        const data = await res.json();
        if (!data.items || data.items.length === 0) {
          resultsDiv.innerHTML = `<div style="color:#ccc;padding:12px">No results found.</div>`;
          return;
        }
        showResults(data.items);
      } catch (err) {
        console.error(err);
        resultsDiv.innerHTML = `<div style="color:#f88;padding:12px">Search failed. Check console.</div>`;
      }
    }

    function showResults(items) {
      resultsDiv.innerHTML = "";
      items.forEach(item => {
        const vid = item.id.videoId;
        const title = item.snippet.title;
        const channel = item.snippet.channelTitle;
        const thumb = (item.snippet.thumbnails && item.snippet.thumbnails.medium) ? item.snippet.thumbnails.medium.url : "";

        const div = document.createElement("div");
        div.className = "result-item";
        div.innerHTML = `
          <img src="${thumb}" alt="thumb">
          <div class="info">
            <strong>${escapeHtml(title)}</strong>
            <span>${escapeHtml(channel)}</span>
          </div>
        `;
        div.addEventListener("click", () => playAudio(vid, title, channel));
        resultsDiv.appendChild(div);
      });
    }

    function playAudio(videoId, title, channel) {
      // show UI
      nowPlaying.style.display = "block";
      pauseBtn.style.display = "inline-block";
      seekBar.style.display = "block";
      timeDisplay.style.display = "flex";
      nowPlaying.textContent = `üéß Now Playing: ${title} ‚Äî ${channel}`;

      if (ytPlayer) {
        ytPlayer.loadVideoById(videoId);
      } else {
        ytPlayer = new YT.Player("player", {
          height: "0", width: "0",
          videoId: videoId,
          playerVars: { autoplay: 1, controls: 0, disablekb: 1 },
          events: {
            onReady: (e) => { e.target.playVideo(); startUpdatingSeekBar(); },
            onStateChange: handleStateChange
          }
        });
      }
      startUpdatingSeekBar();
    }

    function handleStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        startUpdatingSeekBar();
        isPaused = false;
        pauseBtn.textContent = "‚è∏ Pause";
      } else if (event.data === YT.PlayerState.PAUSED) {
        clearInterval(updateInterval);
        isPaused = true;
        pauseBtn.textContent = "‚ñ∂Ô∏è Resume";
      } else if (event.data === YT.PlayerState.ENDED) {
        clearInterval(updateInterval);
      }
    }

    function startUpdatingSeekBar() {
      clearInterval(updateInterval);
      updateInterval = setInterval(() => {
        if (ytPlayer && typeof ytPlayer.getDuration === "function") {
          const cur = ytPlayer.getCurrentTime();
          const dur = ytPlayer.getDuration();
          if (dur && !isNaN(dur) && dur > 0) {
            seekBar.value = (cur / dur) * 100;
            currentTimeEl.textContent = formatTime(cur);
            totalTimeEl.textContent = formatTime(dur);
          }
        }
      }, 400);
    }

    seekBar.addEventListener("input", () => {
      if (ytPlayer && typeof ytPlayer.getDuration === "function") {
        const dur = ytPlayer.getDuration();
        const seekTo = (seekBar.value / 100) * dur;
        ytPlayer.seekTo(seekTo, true);
      }
    });

    pauseBtn.addEventListener("click", () => {
      if (!ytPlayer) return;
      if (isPaused) {
        ytPlayer.playVideo();
        pauseBtn.textContent = "‚è∏ Pause";
        isPaused = false;
      } else {
        ytPlayer.pauseVideo();
        pauseBtn.textContent = "‚ñ∂Ô∏è Resume";
        isPaused = true;
      }
    });

    function formatTime(sec) {
      if (!sec || isNaN(sec)) return "0:00";
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60).toString().padStart(2, "0");
      return `${m}:${s}`;
    }

    // search interactions
    searchBtn.addEventListener("click", () => {
      const q = queryInput.value.trim();
      if (!q) return;
      // ensure captcha done (overlay gone)
      const locked = document.getElementById("locked");
      if (locked && locked.style.display !== "none") {
        alert("Please verify with reCAPTCHA first.");
        return;
      }
      searchYouTube(q);
    });

    queryInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") searchBtn.click();
    });

    // helper: escape HTML for safety in result text
    function escapeHtml(unsafe) {
      return unsafe.replace(/[&<"'>]/g, function(m) {
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
      });
    }

    /* ============== Load YouTube iframe API ============== */
    (function loadYouTubeAPI(){
      const s = document.createElement("script");
      s.src = "https://www.youtube.com/iframe_api";
      document.body.appendChild(s);
    })();

    // accessibility: allow title to be focusable/keyboard-activated
    titleEl.tabIndex = 0;
    titleEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); titleEl.click(); }
    });

  </script>
</body>
</html>
